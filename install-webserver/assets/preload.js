"use strict";var p=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var f=Object.getOwnPropertyNames;var S=Object.prototype.hasOwnProperty;var E=(n,t,d,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of f(t))!S.call(n,o)&&o!==d&&p(n,o,{get:()=>t[o],enumerable:!(e=x(t,o))||e.enumerable});return n};var L=n=>E(p({},"__esModule",{value:!0}),n);var C={};module.exports=L(C);var l=require("electron"),m=()=>l.ipcRenderer.sendSync("SLACKMOD_GET_PLUGINS"),i=(n,t)=>l.ipcRenderer.sendSync("SLACKMOD_READ_FILE",{pluginId:n,filePath:t});l.contextBridge.exposeInMainWorld("slackmod_custom",{getPluginList:m,getPluginFile:i});window.addEventListener("DOMContentLoaded",()=>{console.log("[SlackMod] Preload loaded. Initializing plugins...");let n=i(null,"plugin-manager.js");if(n)try{let e=new Blob([n],{type:"text/javascript"}),o=URL.createObjectURL(e),r=document.createElement("script");r.src=o,r.onload=()=>{try{URL.revokeObjectURL(o)}catch{}r.removeAttribute("src")},r.setAttribute("data-slackmod","plugin-manager"),(document.head||document.documentElement).appendChild(r)}catch(e){console.error("GUI Init Error",e)}let t=i(null,"plugin-manager.css");if(t)try{let e=document.createElement("style");e.setAttribute("data-slackmod","plugin-manager-style"),e.textContent=t,document.head.appendChild(e)}catch(e){console.error("CSS Init Error",e)}let d=m();console.log(`[SlackMod] Found ${d.length} plugins.`),d.forEach(e=>{let o=e.manifest.entry||"index.js",r=i(e.id,o);if(!r)return;let s={exports:{}},u=c=>{let g=i(e.id,c);if(!g)return console.error(`Cannot find module '${c}' in plugin '${e.id}'`),null;let a={exports:{}};try{new Function("require","module","exports",g)(u,a,a.exports)}catch(y){console.error(`Error requiring ${c}:`,y)}return a.exports};try{new Function("require","module","exports",r)(u,s,s.exports),s.exports&&typeof s.exports.onStart=="function"&&s.exports.onStart(),console.log(`[SlackMod] Loaded: ${e.id}`)}catch(c){console.error(`[SlackMod] Failed to load ${e.id}:`,c)}})});
